# Consistency Models

https://arxiv.org/pdf/2303.01469.pdf

https://github.com/openai/consistency_models 

https://readpaper.com/pdf-annotate/note?pdfId=4761865581863370753&noteId=2187834810264506624

## 核心问题是什么?

扩散模型在图像、音频和视频生成方面取得了重大突破，但它们依赖于迭代生成过程，导致采样速度较慢，限制了其实时应用的潜力。  
现有的快速采样方法包括更快的数值ODE求解器和蒸馏技术。ODE求解器仍然需要超过10个评估步骤来生成有竞争力的样本。大多数蒸馏方法，依赖于在蒸馏之前从扩散模型中收集大量的样本数据集，这本身就是计算成本很高的。据我们所知，唯一不受这一缺点影响的蒸馏方法是渐进蒸馏(PD)。  

## 核心贡献是什么？

1. 一致性模型在设计上支持快速的一步生成，同时仍然允许少步采样以换取样本质量的计算。
2. 一种新的生成模型家族，可以在没有对抗性训练的情况下实现高样本质量
3. 支持zero-shot数据编辑，如图像修补、着色和超分辨率，而不需要对这些任务进行明确的训练。
4. 一致性模型既可以作为提取预训练扩散模型的一种方式训练，也可以作为独立的生成模型训练。

## 大致方法是什么？

我们建立在连续时间扩散模型中的概率流(PF)常微分方程(ODE)之上（简单来说，就是图像前向传播的无参加噪过程），其轨迹平滑地将数据分布转换为可处理的噪声分布。而CM可将任何时间步骤的任何分布点映射到轨迹的起点。CM模型的一个显著特性是自一致性:同一轨迹上的点映射到相同的起始点。因此，我们把这样的模型称为一致性模型。

![](./assets/367ac711d276005e48b55de2b5bb5176_0_Figure_1_-730704248.png)

### 一致性模型的定义

假设存在一个函数f，对于同一条PF ODE轨迹上的任意点都有相同的输出:  

$$
\boldsymbol{f} ( x_t , t ) = \boldsymbol{f} ( x_{t^{\prime}} , t^{\prime} )  \text { for all }  t , t ^{\prime} \in [ \epsilon , T ]
$$

![](./assets/367ac711d276005e48b55de2b5bb5176_2_Figure_2_-1638748072.png)

consistency model的目标是从数据中估计一致性函数f，来迫使self-consistency性质

### 一致性模型参数化

要拟合的一致性函数 \\( f(\cdot, \cdot) \\)要满足两个条件：①同一个轨迹上的点输出一致；②在起始点f为一个对于x的恒等函数

第一种做法简单地参数化consistency models

![](./assets/3365b5ea5a7840f4a17fbb9f9acb11d5.png)

第二种做法使用跳跃连接（作者和许多其他的都用这个）

![](./assets/77f22f9854ff47018daf22ae3e93b5e6.png)

其中 \\(c_{skip}\\)和 \\(c_{out}\\)为可微函数，满足 \\(c_{skip}(\epsilon) = 1, c_{out}(\epsilon) = 0\\). \\(F_{\theta}\\)为深度神经网络，可使用一致性损失来学习，输出维度同 x.

## 有效

## 缺陷

## 验证

## 启发

## 遗留问题

## 参考材料
[1] https://zhuanlan.zhihu.com/p/621673283
[2] https://blog.csdn.net/singxsy/article/details/130243343
[3] https://blog.csdn.net/WiSirius/article/details/134670307
[4] https://www.jianshu.com/p/3b712cbe6d0d